## 프로젝트 리포트: SOOP 실시간 데이터 파싱 엔진

###  프로젝트 개요
목적: SOOP(아프리카TV)의 웹소켓(WebSocket) 프로토콜을 분석하여 별도의 브라우저 없이 실시간 채팅 데이터와 후원(별풍선) 정보를 수집 및 정제하는 고성능 크롤링 엔진 구축.

배경: 기존 Selenium 기반 크롤링의 높은 리소스 점유율과 낮은 실시간성을 극복하기 위해 서버와 클라이언트 간의 저수준(Low-level) 패킷 통신을 직접 제어함.

### 프로젝트 핵심 로직 및 구현 방식
A. 웹소켓 핸드쉐이크 (Handshake)

1단계 (Connect): 서버와의 초기 소켓 연결을 확립 (ServiceType 0001).

2단계 (Join): 특정 방송방(CHATNO)에 입장하기 위해 FTK(인증 티켓)를 포함한 패킷 송신 (ServiceType 0002).

비회원 접속 최적화: 복잡한 로그인 쿠키 없이도 데이터를 수집할 수 있도록 비회원 전용 핸드쉐이크 구조 설계.

B. 패킷 구조 및 데이터 파싱

12자리 헤더 규칙: SOOP 전용 패킷 규격인 명령어(4자리) + 바디 길이(6자리) + 예비(2자리) 형식을 create_packet 함수로 자동화하여 구현.

구분자 분석: 바이트 데이터 내의 특수 구분자(\x0c, 상수 F)를 기준으로 데이터를 분할하여 닉네임, 메시지, 유저 플래그 등을 정확한 인덱스에서 추출.

C. 비트 플래그 기반 유저 상태 판별

비트 마스킹(Bit Masking): 서버에서 전달되는 정수형 플래그 값을 비트 단위로 연산(&)하여 유저의 권한(BJ, 매니저, 구독자, 열혈팬, 팬클럽)을 실시간으로 식별하고 배지로 표시.

D. 안정성 및 최적화 (Self-Healing)

수동 핑(Manual Ping): 라이브러리 자동 핑 대신 서버 규격에 맞는 0000 패킷을 주기적으로 송신하여 타임아웃(ConnectionClosedError) 방지.

자동 재접속: 방송 종료나 네트워크 순단 시 10초 이내에 정보를 갱신하여 자동으로 재연결하는 루프 구조 설계.

비동기 병렬 처리: asyncio.create_task를 활용하여 데이터 수신과 파싱을 분리, 초당 수천 개의 트래픽이 발생하는 대형 방송에서도 지연 없는 처리 가능.

### 주요 참고 리소스 및 기술적 가치
참고 리소스	핵심 추출 내용	프로젝트 반영 사항
채수현 개발일지	웹소켓 분석의 시초, 초기 핸드쉐이크 값 확인	기본적인 소켓 연결 메커니즘 구축
DOCHIS(헛삯) 분석	패킷 헤더의 12자리 규칙 및 동적 바이트 길이 계산의 중요성 강조	create_packet 함수 및 동적 헤더 생성 로직 구현
HO-Silverplate Gist	서비스 타입(0005, 0104 등) 및 채팅 패킷의 상세 인덱스 명세	정확한 채팅/공지/후원 데이터 분류 체계 수립
SSAPI 개발 회고	대규모 트래픽 처리 경험, 리소스 절감(Snappy 압축 언급) 및 비용 최적화 철학	비동기 병렬 처리 및 이벤트 선택 수신(Mode) 기능 도입

### 상세 ServiceType 정의 (패킷 명세 기반)

0000 (PING): 연결 유지를 위한 하트비트.

0001 (LOGIN): 서버 초기 접속 확인.

0002 (JOIN): 특정 채팅방 입장 승인.

0005 (CHATTING): 일반 사용자 채팅 메시지.

0012 (BALLOON): 별풍선 후원 발생 (개수, 닉네임 포함).

0104 (NOTICE): 방송 상단 공지사항 및 운영 메시지.

### 결론 및 향후 발전 방향
본 프로젝트는 **안정성(Fail-over)**과 **효율성(Low-latency)**에 집중하여 설계되었습니다. 단순히 채팅을 읽는 것을 넘어, 유저의 상태를 실시간으로 분석하고 후원 데이터를 통계화할 수 있는 강력한 데이터 수집 기반을 갖추었습니다.

다음 단계 제안:

데이터 저장: 수집된 채팅을 SQLite나 JSONL 포맷으로 실시간 저장하여 분석용 데이터셋 구축.

통계 대시보드: 세션 동안의 총 별풍선, 가장 많이 언급된 단어 등을 시각화하는 웹 대시보드 연결.

알림 봇 연동: 특정 열혈팬 입장이나 대량 후원 발생 시 Discord/Telegram 알림 전송 기능 추가.

[채수현 개발일지] - 아프리카TV 실시간 채팅 크롤링의 기초 메커니즘 제공

[DOCHIS(헛삯)] - 패킷 헤더의 6자리 길이 계산 규칙 및 운영 안정성 철학 정립

[HO-Silverplate] - ServiceType 및 채팅 패킷 인덱스 상세 명세 제공